<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Snr. Buns - Home</title>

  <!-- Bootstrap CSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&display=swap" rel="stylesheet" />

  <script type="module" src="auth.js"></script>

  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      background-color: #fff4d6;
      margin: 0;
      display: flex;
      min-height: 100vh;
      color: #333;
    }
    .sidebar {
      background-color: #c82333;
      width: 220px;
      color: white;
      padding: 2rem 1.5rem;
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }
    .sidebar h2 {
  font-weight: 700;
  font-size: 1.8rem;
  margin-bottom: 2rem;
  user-select: none;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.4rem;
  white-space: nowrap;   /* ‚úÖ prevents wrapping */
}

    .sidebar a {
      color: white;
      text-decoration: none;
      font-weight: 600;
      padding: 0.75rem 0.5rem;
      border-radius: 4px;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: background-color 0.3s;
      user-select: none;
    }
    .sidebar a:hover,
    .sidebar a.active {
      background-color: #a71d2a;
      text-decoration: none;
    }
    main.home-content {
      flex-grow: 1;
      padding: 2rem 2.5rem;
      background-color: #fff4d6;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }

    header.welcome {
      text-align: center;
    }
    header.welcome h1 {
      font-weight: 700;
      color: #c82333;
      font-size: 2.5rem;
      margin-bottom: 0.25rem;
      user-select: none;
    }
    header.welcome p {
      font-weight: 600;
      color: #555;
      margin-top: 0;
      user-select: none;
    }

    section.quick-stats {
      display: flex;
      gap: 1.5rem;
      flex-wrap: wrap;
      justify-content: center;
    }
    .quick-card {
      background: white;
      padding: 1rem 2rem;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgb(0 0 0 / 0.1);
      min-width: 140px;
      text-align: center;
      user-select: none;
    }
    .quick-card h3 {
      margin: 0.2rem 0;
      font-size: 1.6rem;
      color: #c82333;
    }
    .quick-card p {
      margin: 0;
      font-weight: 600;
      color: #333;
    }

    section.recent-orders {
      background: white;
      padding: 1rem 1.5rem;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgb(0 0 0 / 0.1);
      max-width: 900px;
      margin: 0 auto;
    }
    .recent-orders h2 {
      font-weight: 700;
      color: #c82333;
      margin-top: 0;
      margin-bottom: 1rem;
      user-select: none;
    }
    .recent-orders ul {
      list-style: none;
      padding-left: 0;
      margin: 0;
      max-height: 220px;
      overflow-y: auto;
    }
    .recent-orders li {
      padding: 0.4rem 0.6rem;
      border-bottom: 1px solid #eee;
      font-weight: 600;
      font-size: 1rem;
      display: flex;
      justify-content: space-between;
      user-select: none;
    }
    .recent-orders li:last-child {
      border-bottom: none;
    }

    section.quick-nav {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: center;
    }
    .quick-nav a {
      background-color: #c82333;
      color: white;
      font-weight: 700;
      padding: 1rem 1.75rem;
      border-radius: 8px;
      text-decoration: none;
      user-select: none;
      transition: background-color 0.3s;
      display: inline-block;
      min-width: 140px;
      text-align: center;
    }
    .quick-nav a:hover {
      background-color: #a71d2a;
    }

    section.alerts {
      max-width: 900px;
      background: white;
      padding: 0.4rem 0.6rem;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgb(0 0 0 / 0.1);
      margin: 0 auto;
    }
    .alerts h2 {
      font-weight: 700;
      color: #c82333;
      margin-top: 0;
      margin-bottom: 1rem;
      user-select: none;
    }
    .alerts ul {
      list-style: none;
      padding-left: 1rem;
      margin: 0;
      font-weight: 600;
      color: #333;
    }
    .alerts ul li {
      margin-bottom: 0.3rem;
    }

    /* Scrollbar for recent orders */
    .recent-orders ul::-webkit-scrollbar {
      width: 7px;
    }
    .recent-orders ul::-webkit-scrollbar-thumb {
      background-color: #c82333;
      border-radius: 20px;
    }

    .announcement-banner {
    background-color: #c82333;
    color: #fff4d6;
    font-family: 'Montserrat', sans-serif;
    font-weight: 700;
    padding: 0.5rem 0;
    overflow: hidden;
    white-space: nowrap;
    box-sizing: border-box;
    user-select: none;
  }

  .announcement-banner span {
    display: inline-block;
    padding-left: 100%;
    animation: scroll-left 40s linear infinite;
  }

  /* Adjust animation duration for speed */
  @keyframes scroll-left {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-100%);
    }
  }

  /* Hamburger button */
.hamburger {
  display: none;
  font-size: 2rem;
  background: #c82333;
  color: white;
  border: none;
  border-radius: 8px;     /* matches other buttons */
  padding: 6px 12px;
  cursor: pointer;
  position: fixed;
  top: 15px;
  left: 15px;
  z-index: 3000;
  box-shadow: 0 2px 6px rgba(0,0,0,0.25); /* permanent shadow */
  transition: background 0.2s;
}
.hamburger:hover {
  background: #a71d2a;
}


/* Sidebar adjustments for mobile */
@media (max-width: 768px) {
  .hamburger {
    display: block; /* show hamburger on small screens */
  }

  announcement-banner {
    margin-top: 60px; /* push it down below the hamburger */

  }

  .sidebar {
    position: fixed;
    top: 0;
    left: 0;
    height: 100vh;
    width: 220px;
    background-color: #c82333;
    transform: translateX(-100%); /* hidden */
    transition: transform 0.3s ease;
    z-index: 1500;
  }

  .sidebar.active {
    transform: translateX(0); /* slide in */
  }

  /* Make sure main content isn‚Äôt squeezed */
  .main-container {
    flex-direction: column;
  }
  main {
    padding: 100px 1rem 1rem;
    margin-left: 0;
  }
}

  </style>
</head>
<body>
  <button id="menuToggle" class="hamburger">‚ò∞</button>
  <div class="main-container" style="display:flex; width:100%; min-height:100vh;">
    <aside class="sidebar">
      <h2>üçî Snr. Buns</h2>
      <nav>
        <ul class="list-unstyled">
          <li><a href="home.html" class="active">üè† Home</a></li>
          <li><a href="register.html">üñãÔ∏è Register</a></li>
          <li><a href="orders.html">üìã Orders</a></li>
          <li><a href="inventory.html">üì¶ Inventory</a></li>
          <li><a href="market.html">üè™ Market Run</a></li>
          <li><a href="staffmeals.html">üçΩÔ∏è Staff Meals</a></li>
          <li><a href="loyalty.html">üéÅ Customers</a></li>
        </ul>
      </nav>
    </aside>

    <main class="home-content">

      <div class="announcement-banner" aria-live="polite" aria-atomic="true">
  <span>
    ‚úÖ Remember to clock in/out at start of shift and end of shift! &nbsp;&nbsp;|&nbsp;&nbsp;
    ‚è∞ Clock in and out on emails for weekly bonuses &nbsp;&nbsp;|&nbsp;&nbsp;
    üí∏ Double-check invoices before sending &nbsp;&nbsp;|&nbsp;&nbsp;
  </span>
</div>

      <header class="welcome">
        <h1>üçî Welcome to Snr. Buns!</h1>
        <p>Your quick overview & stats dashboard</p>

        <p style="margin-top:-0.5rem; margin-bottom:1rem; font-weight:600; color:#c82333;">
  Please report any issues with the website via emails.
</p>
      </header>

      <section class="quick-stats" aria-label="Key statistics summary">
        <div class="quick-card" role="region" aria-live="polite" aria-atomic="true" aria-relevant="text">
          <p>Orders Today</p>
          <h3 id="ordersToday">0</h3>
        </div>
        <div class="quick-card" role="region" aria-live="polite" aria-atomic="true" aria-relevant="text">
          <p>Low Stock Items</p>
          <h3 id="lowStockCount">0</h3>
        </div>
        <div class="quick-card" role="region" aria-live="polite" aria-atomic="true" aria-relevant="text">
          <p>Total Visits</p>
          <h3 id="loyaltyVisits">0</h3>
        </div>
      </section>

      <section class="quick-nav" aria-label="Quick navigation links">
        <a href="register.html">üñãÔ∏è Register</a>
        <a href="orders.html">üìã Orders</a>
        <a href="inventory.html">üì¶ Inventory</a>
        <a href="market.html">üè™ Market Run</a>
        <a href="staffmeals.html">üçΩÔ∏è Staff Meals</a>
        <a href="loyalty.html">üéÅ Customers</a>
      </section>

      <section class="recent-orders" aria-label="Recent orders">
        <h2>üßæ Recent Orders</h2>
        <ul id="recentOrdersList" tabindex="0">
          <!-- Populated by JS -->
        </ul>
      </section>

      

      <section class="alerts" aria-label="Inventory alerts">
        <h2>‚ö†Ô∏è Inventory Alerts</h2>
        <ul id="inventoryAlertsList">
          <!-- Populated by JS -->
        </ul>
      </section>
    </main>
  </div>

<script type="module">
import {
  getFirestore, collection, query, where, orderBy, updateDoc, doc, onSnapshot
} from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

import { app } from "./auth.js"; // reuses the initialized app
const db = getFirestore(app);

const LOW_STOCK_THRESHOLD = 21;

/* ===== Date Helpers ===== */
function isSameDayEST(date) {
  if (!date) return false;
  const estDate = new Date(date.toLocaleString("en-US", { timeZone: "America/New_York" }));
  const todayEST = new Date(new Date().toLocaleString("en-US", { timeZone: "America/New_York" }));
  return estDate.toDateString() === todayEST.toDateString();
}

function formatDate(date) {
  if (!date) return "-";
  return date.toLocaleString("en-US", {
    timeZone: "America/New_York",
    month: "2-digit",
    day: "2-digit",
    year: "numeric",
    hour: "2-digit",
    minute: "2-digit",
    hour12: true
  }).replace(",", "");
}

/* ===== UI Update Functions ===== */
function updateInventoryUI(inventory) {
  // Effective patties = patties + ground beef packs √ó 5
  const patties = Number(inventory.burger_patties || 0);
  const groundBeef = Number(inventory.ground_beef || 0);
  const effectivePatties = patties + (groundBeef * 5);

  const adjustedInventory = { ...inventory, ground_beef: effectivePatties };

  // Low stock
  const lowStock = Object.entries(adjustedInventory).filter(([_, qty]) => qty < LOW_STOCK_THRESHOLD);
  document.getElementById("lowStockCount").textContent = lowStock.length;

  const ingredients = {
    burger_buns: "Burger Buns",
    sugar: "Sugar Packs",
    flour: "Flour",
    lettuce: "Lettuce",
    cheese_slices: "Cheddar Cheese Slices",
    ground_beef: "Ground Beef / Patties",
    corn_syrup: "Corn Syrup Bottles",
    potato: "Potato Sack"
  };

  const alertsList = document.getElementById("inventoryAlertsList");
  alertsList.innerHTML = "";
  if (lowStock.length === 0) {
    alertsList.innerHTML = `<li>No current inventory alerts.</li>`;
  } else {
    lowStock.forEach(([key]) => {
      const li = document.createElement("li");
      li.textContent = `‚ö†Ô∏è Low stock: ${ingredients[key]}`;
      alertsList.appendChild(li);
    });
  }
}

function updateOrdersUI(orders) {
  // Orders today (EST-based)
  const ordersToday = orders.filter(order => isSameDayEST(order.timestamp));
  document.getElementById("ordersToday").textContent = ordersToday.length;

  // Total visits (all orders, regardless of deleted)
  const counts = {};
  orders.forEach(order => {
    const customer = order.customer?.toLowerCase()?.trim();
    if (customer) counts[customer] = (counts[customer] || 0) + 1;
  });
  const totalVisits = Object.values(counts).reduce((sum, v) => sum + v, 0);
  document.getElementById("loyaltyVisits").textContent = totalVisits;

  // Recent orders
  const list = document.getElementById("recentOrdersList");
  list.innerHTML = "";
  const last5 = orders.slice(0, 5);
  if (last5.length === 0) {
    list.innerHTML = `<li>No orders placed yet.</li>`;
  } else {
    last5.forEach(order => {
      const li = document.createElement("li");
      const clearedLabel = order.deleted ? " ‚úÖ Completed" : "";
      li.textContent = `${formatDate(order.timestamp)} - ${order.customer} (Total: $${order.total.toFixed(2)})${clearedLabel}`;
      list.appendChild(li);
    });
  }
}

/* ===== Live Listeners ===== */
onSnapshot(doc(db, "inventory", "current"), (docSnap) => {
  if (docSnap.exists()) updateInventoryUI(docSnap.data());
});

onSnapshot(query(collection(db, "orders"), orderBy("timestamp", "desc")), (snapshot) => {
  const orders = snapshot.docs.map(doc => ({
    ...doc.data(),
    id: doc.id,
    timestamp: doc.data().timestamp?.toDate?.() || null
  }));
  updateOrdersUI(orders);
});
</script>
<script>
  const menuBtn = document.getElementById("menuToggle");
  const sidebar = document.querySelector(".sidebar");

  menuBtn.addEventListener("click", () => {
    sidebar.classList.toggle("active");

    // Switch between ‚ò∞ and ‚úñ
    if (sidebar.classList.contains("active")) {
      menuBtn.textContent = "‚úñ";
    } else {
      menuBtn.textContent = "‚ò∞";
    }
  });
</script>


</body>
</html>
